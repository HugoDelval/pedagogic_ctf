import subprocess


def run_cmd(cmd_list):
    child = subprocess.Popen(cmd_list, stdout=subprocess.PIPE)
    streamdata = child.communicate()[0]
    ret = child.returncode
    return streamdata.decode(), ret


def exploit(binary, randomize):
    """
        Check if the corrected source code is still vulnerable
    """
    out_1, _ = run_cmd([binary, 'test', '', '/get-token'])
    out_2, _ = run_cmd([binary, 'test', '', '/get-token'])

    if out_1 == out_2:
        print('Your generated token does not seems to be random\n')
        return True

    return False
